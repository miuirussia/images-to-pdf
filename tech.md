## Приложение для конвертации изображений в PDF

### 1. Обзор проекта

**Название:** Image to PDF Converter

**Описание:** Десктопное приложение для объединения нескольких изображений в один PDF-файл с возможностью настройки размера страниц.

**Целевая платформа:** Windows, macOS, Linux (через Tauri 2.0)

***

### 2. Технологический стек

**Frontend:**
- React 18+ с TypeScript
- Shadcn UI для компонентов интерфейса
- Tailwind 4 для стилизации
- Zustand для управления состоянием

**Backend:**
- Tauri 2.0 (Rust)
- Библиотека `image` для обработки изображений
- Библиотека `printpdf` или `lopdf` для генерации PDF

**Дополнительные инструменты:**
- Vite для сборки frontend
- pnpm для управления зависимостями

***

### 3. Функциональные требования

#### 3.1 Основной функционал

**Загрузка изображений:**
- Поддержка форматов: PNG, JPEG, JPG, WEBP, BMP, GIF, TIFF
- Методы загрузки:
  - Drag & Drop область
  - Кнопка "Выбрать файлы" (множественный выбор)
  - Загрузка папки целиком
- Отображение превью загруженных изображений
- Возможность загрузки до 100 изображений за раз

**Управление списком изображений:**
- Отображение миниатюр изображений в списке
- Показ имени файла и размера изображения
- Перетаскивание изображений для изменения порядка (drag & drop)
- Удаление отдельных изображений из списка
- Кнопка "Очистить все"
- Счетчик количества изображений

**Настройки PDF:**
- Выбор размера страницы:
  - A4 (210×297 мм) — по умолчанию
  - A3 (297×420 мм)
  - A5 (148×210 мм)
  - Letter (216×279 мм)
  - Legal (216×356 мм)
  - Произвольный размер (ввод ширины и высоты в мм)
- Выбор ориентации страницы:
  - Портретная (по умолчанию)
  - Альбомная
- Режим размещения изображения на странице:
  - Fit to page (вписать в страницу с сохранением пропорций)
  - Fill page (заполнить страницу, возможна обрезка)
  - Original size (оригинальный размер, центрирование)

**Генерация PDF:**
- Кнопка "Создать PDF"
- Диалог выбора места сохранения файла
- Индикатор прогресса обработки
- Уведомление об успешном создании файла
- Возможность открыть созданный PDF после завершения

#### 3.2 Дополнительный функционал

- Автоматическое определение оптимальной ориентации страницы на основе пропорций изображения
- Предпросмотр результата перед сохранением
- Сохранение последних использованных настроек
- Поддержка темной и светлой темы интерфейса

***

### 4. Нефункциональные требования

**Производительность:**
- Обработка одного изображения < 500 мс
- Генерация PDF из 50 изображений < 10 секунд
- Плавная работа интерфейса без зависаний
- Оптимизация изображений png (oxipng) и jpeg

**Юзабилити:**
- Интуитивно понятный интерфейс
- Минималистичный дизайн
- Быстрый доступ к основным функциям
- Информативные сообщения об ошибках

**Надежность:**
- Валидация форматов файлов перед обработкой
- Обработка ошибок при чтении поврежденных изображений
- Предотвращение сохранения пустого PDF
- Проверка доступного места на диске перед сохранением

**Безопасность:**
- Обработка файлов только локально (без отправки данных в сеть)
- Валидация путей к файлам
- Ограничение максимального размера обрабатываемых файлов (например, 50 МБ на изображение)

***

### 5. Архитектура приложения

#### 5.1 Структура frontend (React)

```
src/
├── components/
│   ├── ui/              # Shadcn UI компоненты
│   ├── ImageUploader.tsx
│   ├── ImageList.tsx
│   ├── ImageItem.tsx
│   ├── SettingsPanel.tsx
│   ├── ExportButton.tsx
│   └── ProgressDialog.tsx
├── lib/
│   ├── tauri.ts         # Обертки для Tauri API
│   └── utils.ts
├── types/
│   └── index.ts
├── App.tsx
└── main.tsx
```

#### 5.2 Структура backend (Rust)

```
src-tauri/
├── src/
│   ├── commands/
│   │   ├── image.rs      # Обработка изображений
│   │   └── pdf.rs        # Генерация PDF
│   ├── utils/
│   │   └── validation.rs
│   ├── main.rs
│   └── lib.rs
└── Cargo.toml
```

***

### 6. API между frontend и backend

**Tauri Commands:**

```typescript
// Валидация изображений
invoke('validate_images', { paths: string[] }): Promise<ValidationResult>

// Генерация PDF
invoke('generate_pdf', { 
  imagePaths: string[],
  outputPath: string,
  settings: PdfSettings 
}): Promise<GenerationResult>

// Получение информации об изображении
invoke('get_image_info', { path: string }): Promise<ImageInfo>
```

**Типы данных:**

```typescript
interface PdfSettings {
  pageSize: 'A4' | 'A3' | 'A5' | 'Letter' | 'Legal' | 'Custom';
  customWidth?: number;  // в мм
  customHeight?: number; // в мм
  orientation: 'Portrait' | 'Landscape';
  fitMode: 'Fit' | 'Fill' | 'Original';
}

interface ImageInfo {
  width: number;
  height: number;
  format: string;
  sizeBytes: number;
}

interface ValidationResult {
  valid: string[];
  invalid: { path: string; reason: string }[];
}

interface GenerationResult {
  success: boolean;
  outputPath?: string;
  error?: string;
}
```

***

### 7. UI/UX требования

#### 7.1 Структура интерфейса

**Основной экран:**
```
┌─────────────────────────────────────────────┐
│ Image to PDF Converter                   [⚙] │
├─────────────────────────────────────────────┤
│                                             │
│  ┌───────────────────────────────────────┐ │
│  │   Перетащите изображения сюда        │ │
│  │   или                                │ │
│  │   [Выбрать файлы]  [Выбрать папку]  │ │
│  └───────────────────────────────────────┘ │
│                                             │
│  Изображения (3):                          │
│  ┌───────────────────────────────────────┐ │
│  │ [img] image1.png     [↑] [↓] [×]     │ │
│  │ [img] image2.jpg     [↑] [↓] [×]     │ │
│  │ [img] image3.png     [↑] [↓] [×]     │ │
│  └───────────────────────────────────────┘ │
│                                             │
│  Настройки:                                │
│  Размер страницы: [A4 ▼]                  │
│  Ориентация: (•) Портрет  ( ) Альбом      │
│  Размещение: [Вписать в страницу ▼]      │
│                                             │
│  [Очистить]              [Создать PDF]    │
└─────────────────────────────────────────────┘
```

#### 7.2 Цветовая схема (Shadcn)

- Использовать стандартную палитру Shadcn UI
- Поддержка light/dark темы
- Акцентный цвет для кнопок действий
- Нейтральные тона для основного интерфейса

#### 7.3 Компоненты Shadcn

- Button
- Card
- Select
- RadioGroup
- Progress
- Dialog
- Alert
- ScrollArea
- Separator
- Label
- Input

***

### 8. Обработка ошибок

**Типы ошибок:**

1. **Ошибки валидации:**
   - Неподдерживаемый формат файла
   - Поврежденное изображение
   - Слишком большой размер файла

2. **Ошибки системы:**
   - Недостаточно прав для чтения файла
   - Недостаточно места на диске
   - Ошибка записи PDF файла

3. **Ошибки пользователя:**
   - Не выбраны изображения
   - Некорректные настройки размера страницы

**Отображение ошибок:**
- Toast-уведомления для мелких ошибок
- Dialog для критических ошибок
- Inline-валидация для полей ввода

***

### 9. Тестирование

**Unit-тесты (Rust):**
- Тесты функций обработки изображений
- Тесты генерации PDF
- Тесты валидации входных данных

**Integration-тесты:**
- Тесты Tauri commands
- Тесты полного цикла создания PDF

**E2E-тесты (опционально):**
- Тестирование пользовательских сценариев
- Использование Tauri testing tools

***

### 10. Сборка и распространение

**Конфигурация Tauri:**
```json
{
  "identifier": "com.kdevlab.imageconverter",
  "productName": "Image to PDF Converter",
  "version": "0.0.1"
}
```

**Форматы дистрибутивов:**
- Windows: NSIS installer
- macOS: DMG
- Linux: AppImage

**Размер приложения:** < 20 МБ (целевой)

***

### 12. Этапы разработки

**Этап 1: Инициализация проекта (1-2 часа)**
- Создание Tauri 2.0 проекта
- Настройка React + TypeScript + Vite
- Установка и настройка Shadcn UI
- Настройка Tailwind CSS

**Этап 2: Базовый интерфейс (2-3 часа)**
- Компонент загрузки файлов
- Список изображений
- Панель настроек
- Базовая стилизация

**Этап 3: Rust backend (3-4 часа)**
- Обработка изображений
- Генерация PDF
- Tauri commands
- Валидация данных

**Этап 4: Интеграция (2-3 часа)**
- Связывание frontend и backend
- Обработка ошибок
- Индикаторы прогресса
- Уведомления

**Этап 5: Полировка (2-3 часа)**
- Drag & drop для изображений
- Темная тема
- Оптимизация производительности
- Тестирование

**Этап 6: Сборка (1 час)**
- Конфигурация для разных платформ
- Создание installers
- Тестирование установки

**Общее время:** 11-16 часов

***

### 13. Критерии приемки

✅ Приложение успешно запускается на Windows, macOS, Linux
✅ Поддерживаются все указанные форматы изображений
✅ Работает drag & drop загрузка файлов
✅ Можно изменять порядок изображений
✅ Все настройки PDF работают корректно
✅ Генерация PDF происходит без ошибок
✅ Интерфейс соответствует дизайну Shadcn
✅ Обрабатываются все типы ошибок
✅ Размер приложения < 25 МБ
✅ Производительность соответствует требованиям

***

### 14. Дополнительные заметки

- Использовать актуальную документацию Tauri 2.0
- Следовать best practices React и Rust
- Код должен быть читаемым и документированным
- Использовать TypeScript strict mode
- Применять Rust clippy для проверки качества кода

***

### 15. Пример использования

**Типичный сценарий:**
1. Пользователь запускает приложение
2. Перетаскивает 5 изображений в окно
3. Изменяет порядок изображений
4. Выбирает размер страницы A4, альбомная ориентация
5. Нажимает "Создать PDF"
6. Выбирает место сохранения
7. Получает уведомление об успешном создании
8. Открывает созданный PDF
